import{j as o}from"./index-BsWNCus6.js";import{F as d,i as c,N as p,a as f,Q as E,E as l,A as g,b as N,I as y}from"./form-DWk4cvsd.js";import{r as m}from"./iframe-DXtTJtIS.js";const{addons:T}=__STORYBOOK_MODULE_PREVIEW_API__,Q={layout:"padded",controls:{exclude:["node"]}},q={questionnaireSource:{control:{disable:!0},table:{disable:!0}}};function _(e){return{url:l.ITEM_CONTROL,valueCodeableConcept:{coding:[{system:y,code:e}]}}}function O(e){const r=[...e.extensions??[]];return e.control&&r.push(_(e.control)),e.repeats&&r.push({url:l.MIN_OCCURS,valueInteger:1}),{linkId:e.linkId,text:e.text,type:e.type,repeats:e.repeats,answerOption:e.answerOption&&e.answerOption.length>0?e.answerOption:void 0,answerConstraint:e.answerConstraint,extension:r.length>0?r:void 0,item:e.item}}function C(e,r){const t=g[e];return r.map(n=>N(t,n))}function R(e){const t=new d({resourceType:"Questionnaire",status:"active",item:[O(e)]}).nodes[0];if(!t||!c(t))throw new Error("Questionnaire did not produce a Question node.");return t}function w({node:e}){return m.useEffect(()=>{const r=T.getChannel(),t=f(()=>{const n={response:e.form.response??null};r.emit(E,n)});return()=>{t()}},[e.form]),null}function I({scenario:e,questionnaireSource:r,defaultSource:t}){const n=r||t,{node:i,error:u}=m.useMemo(()=>{try{const s=JSON.parse(n);if(s.resourceType!=="Questionnaire")throw new Error("JSON is not a Questionnaire resource");const a=new d(s).nodes[0];if(!a||!c(a))throw new Error("Questionnaire must contain at least one question item.");return{node:a,error:null}}catch(s){return{node:e.build(),error:s instanceof Error?s.message:String(s)}}},[n,e]);return o.jsxs(o.Fragment,{children:[o.jsx(w,{node:i}),o.jsxs("div",{className:"af-form",style:{maxWidth:760},children:[o.jsx(p,{node:i}),u?o.jsxs("p",{style:{marginTop:"0.75rem",color:"#b91c1c"},children:["Fell back to default questionnaire: ",u]}):null]})]})}I.__docgenInfo={description:"",methods:[],displayName:"NodeShell",props:{scenario:{required:!0,tsType:{name:"signature",type:"object",raw:"{ name: string; title: string; build: () => IQuestionNode }",signature:{properties:[{key:"name",value:{name:"string",required:!0}},{key:"title",value:{name:"string",required:!0}},{key:"build",value:{name:"signature",type:"function",raw:"() => IQuestionNode",signature:{arguments:[],return:{name:"IQuestionNode"}},required:!0}}]}},description:""},questionnaireSource:{required:!0,tsType:{name:"string"},description:""},defaultSource:{required:!0,tsType:{name:"string"},description:""}}};export{I as N,Q as a,q as b,R as c,C as m};
